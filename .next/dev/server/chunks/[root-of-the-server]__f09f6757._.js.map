{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/db/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\n// Configuration pour MongoDB avec logs d√©taill√©s\nconst prisma =\n  globalThis.__prisma ??\n  new PrismaClient({\n    log: [\"query\", \"info\", \"warn\", \"error\"],\n    datasources: {\n      db: {\n        url: process.env.DATABASE_URL,\n      },\n    },\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalThis.__prisma = prisma;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAMA,iDAAiD;AACjD,MAAM,SACJ,WAAW,QAAQ,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAQ;QAAQ;KAAQ;IACvC,aAAa;QACX,IAAI;YACF,KAAK,QAAQ,GAAG,CAAC,YAAY;QAC/B;IACF;AACF;AAEF,wCAA2C;IACzC,WAAW,QAAQ,GAAG;AACxB"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/api/users/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { prisma } from \"@/app/db/prisma\";\nimport bcrypt from \"bcrypt\";\n\nexport async function POST(req: Request) {\n  console.log(\"üî• API /api/users POST appel√©e\");\n\n  try {\n    console.log(\"üì• Lecture du body...\");\n    const body = await req.json();\n    console.log(\"üì¶ Body re√ßu:\", { ...body, password: \"***\" });\n\n    const { name, email, password, role = \"USER\" } = body;\n\n    // Validation des donn√©es\n    if (!name || !email || !password) {\n      console.log(\"‚ùå Validation √©chou√©e: champs manquants\");\n      return NextResponse.json(\n        { error: \"Tous les champs sont requis\" },\n        { status: 400 }\n      );\n    }\n\n    // Validation de l'email\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      console.log(\"‚ùå Validation √©chou√©e: email invalide\");\n      return NextResponse.json(\n        { error: \"Format d'email invalide\" },\n        { status: 400 }\n      );\n    }\n\n    // Validation du mot de passe\n    if (password.length < 6) {\n      console.log(\"‚ùå Validation √©chou√©e: mot de passe trop court\");\n      return NextResponse.json(\n        { error: \"Le mot de passe doit contenir au moins 6 caract√®res\" },\n        { status: 400 }\n      );\n    }\n\n    console.log(\"üîç V√©rification de l'utilisateur existant...\");\n\n    // V√©rifier si l'utilisateur existe d√©j√†\n    const existingUser = await prisma.user.findUnique({\n      where: { email: email.toLowerCase() },\n    });\n\n    console.log(\n      \"üîç Utilisateur existant trouv√©:\",\n      existingUser ? \"OUI\" : \"NON\"\n    );\n\n    if (existingUser) {\n      console.log(\"‚ùå Utilisateur existe d√©j√†\");\n      return NextResponse.json(\n        { error: \"Un compte avec cet email existe d√©j√†\" },\n        { status: 409 }\n      );\n    }\n\n    console.log(\"üîê Hashage du mot de passe...\");\n    // Hasher le mot de passe\n    const saltRounds = 12;\n    const hashedPassword = await bcrypt.hash(password, saltRounds);\n    console.log(\"‚úÖ Mot de passe hash√©\");\n\n    console.log(\"üë§ Cr√©ation de l'utilisateur...\");\n\n    // Cr√©er l'utilisateur\n    const user = await prisma.user.create({\n      data: {\n        name: name.trim(),\n        email: email.toLowerCase().trim(),\n        password: hashedPassword,\n        role: role,\n      },\n    });\n\n    console.log(\"‚úÖ Utilisateur cr√©√© avec l'ID:\", user.id);\n\n    // Retourner les donn√©es sans le mot de passe\n    const { password: _, ...userWithoutPassword } = user;\n\n    const response = {\n      message: \"Utilisateur cr√©√© avec succ√®s\",\n      user: userWithoutPassword,\n    };\n\n    console.log(\"üì§ R√©ponse envoy√©e:\", {\n      ...response,\n      user: { ...response.user, id: \"***\" },\n    });\n\n    return NextResponse.json(response, { status: 201 });\n  } catch (error) {\n    console.error(\"üí• Erreur dans l'API users:\", error);\n\n    if (error instanceof Error) {\n      console.error(\"Message d'erreur:\", error.message);\n      console.error(\"Stack trace:\", error.stack);\n    }\n\n    return NextResponse.json(\n      {\n        error: \"Erreur interne du serveur\",\n        details: error instanceof Error ? error.message : \"Erreur inconnue\",\n      },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET() {\n  console.log(\"üìã API GET /api/users appel√©e\");\n\n  try {\n    const users = await prisma.user.findMany({\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        role: true,\n        createdAt: true,\n        // Ne pas inclure le mot de passe\n      },\n      orderBy: {\n        createdAt: \"desc\",\n      },\n    });\n\n    console.log(\"üìã Nombre d'utilisateurs trouv√©s:\", users.length);\n    return NextResponse.json({ users });\n  } catch (error) {\n    console.error(\"‚ùå Erreur lors de la r√©cup√©ration des utilisateurs:\", error);\n    return NextResponse.json(\n      { error: \"Erreur interne du serveur\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAY;IACrC,QAAQ,GAAG,CAAC;IAEZ,IAAI;QACF,QAAQ,GAAG,CAAC;QACZ,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,iBAAiB;YAAE,GAAG,IAAI;YAAE,UAAU;QAAM;QAExD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,OAAO,MAAM,EAAE,GAAG;QAEjD,yBAAyB;QACzB,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,UAAU;YAChC,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA8B,GACvC;gBAAE,QAAQ;YAAI;QAElB;QAEA,wBAAwB;QACxB,MAAM,aAAa;QACnB,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;YAC3B,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,6BAA6B;QAC7B,IAAI,SAAS,MAAM,GAAG,GAAG;YACvB,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsD,GAC/D;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC;QAEZ,wCAAwC;QACxC,MAAM,eAAe,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAChD,OAAO;gBAAE,OAAO,MAAM,WAAW;YAAG;QACtC;QAEA,QAAQ,GAAG,CACT,mCACA,eAAe,QAAQ;QAGzB,IAAI,cAAc;YAChB,QAAQ,GAAG,CAAC;YACZ,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC;QACZ,yBAAyB;QACzB,MAAM,aAAa;QACnB,MAAM,iBAAiB,MAAM,gHAAM,CAAC,IAAI,CAAC,UAAU;QACnD,QAAQ,GAAG,CAAC;QAEZ,QAAQ,GAAG,CAAC;QAEZ,sBAAsB;QACtB,MAAM,OAAO,MAAM,+HAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACpC,MAAM;gBACJ,MAAM,KAAK,IAAI;gBACf,OAAO,MAAM,WAAW,GAAG,IAAI;gBAC/B,UAAU;gBACV,MAAM;YACR;QACF;QAEA,QAAQ,GAAG,CAAC,iCAAiC,KAAK,EAAE;QAEpD,6CAA6C;QAC7C,MAAM,EAAE,UAAU,CAAC,EAAE,GAAG,qBAAqB,GAAG;QAEhD,MAAM,WAAW;YACf,SAAS;YACT,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC,uBAAuB;YACjC,GAAG,QAAQ;YACX,MAAM;gBAAE,GAAG,SAAS,IAAI;gBAAE,IAAI;YAAM;QACtC;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,UAAU;YAAE,QAAQ;QAAI;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAE7C,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC,qBAAqB,MAAM,OAAO;YAChD,QAAQ,KAAK,CAAC,gBAAgB,MAAM,KAAK;QAC3C;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe;IACpB,QAAQ,GAAG,CAAC;IAEZ,IAAI;QACF,MAAM,QAAQ,MAAM,+HAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,MAAM;gBACN,WAAW;YAEb;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,QAAQ,GAAG,CAAC,qCAAqC,MAAM,MAAM;QAC7D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAM;IACnC,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sDAAsD;QACpE,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}