{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/db/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\n// Configuration pour MongoDB avec logs d√©taill√©s\nconst prisma =\n  globalThis.__prisma ??\n  new PrismaClient({\n    log: [\"query\", \"info\", \"warn\", \"error\"],\n    datasources: {\n      db: {\n        url: process.env.DATABASE_URL,\n      },\n    },\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalThis.__prisma = prisma;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAMA,iDAAiD;AACjD,MAAM,SACJ,WAAW,QAAQ,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAQ;QAAQ;KAAQ;IACvC,aAAa;QACX,IAAI;YACF,KAAK,QAAQ,GAAG,CAAC,YAAY;QAC/B;IACF;AACF;AAEF,wCAA2C;IACzC,WAAW,QAAQ,GAAG;AACxB"}},
    {"offset": {"line": 98, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/api/utils/auth.ts"],"sourcesContent":["import { prisma } from \"@/app/db/prisma\";\nimport jwt from \"jsonwebtoken\";\nimport { NextRequest } from \"next/server\";\n\nconst JWT_SECRET =\n  process.env.JWT_SECRET as string ;\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n  iat?: number;\n  exp?: number;\n}\n\nexport function generateToken(\n  payload: Omit<JWTPayload, \"iat\" | \"exp\">\n): string {\n  return jwt.sign(payload, JWT_SECRET, { expiresIn: \"7d\" });\n}\n\nexport function verifyToken(token: string): JWTPayload {\n  try {\n    return jwt.verify(token, JWT_SECRET) as JWTPayload;\n  } catch (error) {\n    throw new Error(\"Token invalide\");\n  }\n}\n\nexport async function getCurrentUser(request: NextRequest) {\n  try {\n    // Essayer d'abord les cookies\n    let token = request.cookies.get(\"auth-token\")?.value;\n\n    // Si pas de cookie, essayer l'header Authorization\n    if (!token) {\n      const authHeader = request.headers.get(\"authorization\");\n      if (authHeader && authHeader.startsWith(\"Bearer \")) {\n        token = authHeader.substring(7);\n      }\n    }\n\n    if (!token) {\n      console.log(\"üîç Aucun token trouv√©\");\n      return null;\n    }\n\n    const payload = verifyToken(token);\n\n    const user = await prisma.user.findUnique({\n      where: { id: payload.userId },\n      select: {\n        id: true,\n        name: true,\n        email: true,\n        role: true,\n        createdAt: true,\n      },\n    });\n\n    if (!user) {\n      console.log(\"‚ùå Utilisateur non trouv√© pour le token\");\n      return null;\n    }\n\n    return user;\n  } catch (error) {\n    console.error(\"‚ùå Erreur v√©rification token:\", error);\n    return null;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAGA,MAAM,aACJ,QAAQ,GAAG,CAAC,UAAU;AASjB,SAAS,cACd,OAAwC;IAExC,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AACzD;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC3B,EAAE,OAAO,OAAO;QACd,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,eAAe,OAAoB;IACvD,IAAI;QACF,8BAA8B;QAC9B,IAAI,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;QAE/C,mDAAmD;QACnD,IAAI,CAAC,OAAO;YACV,MAAM,aAAa,QAAQ,OAAO,CAAC,GAAG,CAAC;YACvC,IAAI,cAAc,WAAW,UAAU,CAAC,YAAY;gBAClD,QAAQ,WAAW,SAAS,CAAC;YAC/B;QACF;QAEA,IAAI,CAAC,OAAO;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;QAEA,MAAM,UAAU,YAAY;QAE5B,MAAM,OAAO,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,IAAI,QAAQ,MAAM;YAAC;YAC5B,QAAQ;gBACN,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,MAAM;gBACN,WAAW;YACb;QACF;QAEA,IAAI,CAAC,MAAM;YACT,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO;IACT;AACF"}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/api/auth/login/route.ts"],"sourcesContent":["import { generateToken } from \"@/app/api/utils/auth\";\nimport { prisma } from \"@/app/db/prisma\";\nimport bcrypt from \"bcrypt\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { email, password, rememberMe } = await request.json();\n\n    console.log(\"üîê Tentative de connexion:\", { email, rememberMe });\n\n    if (!email || !password) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Email et mot de passe requis\",\n        },\n        { status: 400 }\n      );\n    }\n\n    // Rechercher l'utilisateur\n    const user = await prisma.user.findUnique({\n      where: { email: email.toLowerCase().trim() },\n    });\n\n    if (!user) {\n      console.log(\"‚ùå Utilisateur non trouv√©:\", email);\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Email ou mot de passe incorrect\",\n        },\n        { status: 401 }\n      );\n    }\n\n    // V√©rifier le mot de passe\n    const isValidPassword = await bcrypt.compare(password, user.password);\n\n    if (!isValidPassword) {\n      console.log(\"‚ùå Mot de passe incorrect pour:\", email);\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Email ou mot de passe incorrect\",\n        },\n        { status: 401 }\n      );\n    }\n\n    // G√©n√©rer le token\n    const token = generateToken({\n      userId: user.id,\n      email: user.email,\n    });\n\n    console.log(\"‚úÖ Connexion r√©ussie:\", user.email);\n\n    // Cr√©er la r√©ponse avec le token\n    const response = NextResponse.json({\n      success: true,\n      message: \"Connexion r√©ussie\",\n      token,\n      user: {\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n      },\n    });\n\n    // D√©finir le cookie (optionnel, pour compatibilit√©)\n    response.cookies.set(\"auth-token\", token, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\",\n      maxAge: rememberMe ? 7 * 24 * 60 * 60 : 24 * 60 * 60, // 7 jours ou 1 jour\n    });\n\n    return response;\n  } catch (error: any) {\n    console.error(\"‚ùå Erreur login:\", error);\n\n    return NextResponse.json(\n      {\n        success: false,\n        message: \"Erreur serveur lors de la connexion\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,MAAM,QAAQ,IAAI;QAE1D,QAAQ,GAAG,CAAC,8BAA8B;YAAE;YAAO;QAAW;QAE9D,IAAI,CAAC,SAAS,CAAC,UAAU;YACvB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,OAAO,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACxC,OAAO;gBAAE,OAAO,MAAM,WAAW,GAAG,IAAI;YAAG;QAC7C;QAEA,IAAI,CAAC,MAAM;YACT,QAAQ,GAAG,CAAC,6BAA6B;YACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,2BAA2B;QAC3B,MAAM,kBAAkB,MAAM,gHAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAEpE,IAAI,CAAC,iBAAiB;YACpB,QAAQ,GAAG,CAAC,kCAAkC;YAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;YACX,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,mBAAmB;QACnB,MAAM,QAAQ,IAAA,8IAAa,EAAC;YAC1B,QAAQ,KAAK,EAAE;YACf,OAAO,KAAK,KAAK;QACnB;QAEA,QAAQ,GAAG,CAAC,wBAAwB,KAAK,KAAK;QAE9C,iCAAiC;QACjC,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YACjC,SAAS;YACT,SAAS;YACT;YACA,MAAM;gBACJ,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK;gBACjB,MAAM,KAAK,IAAI;YACjB;QACF;QAEA,oDAAoD;QACpD,SAAS,OAAO,CAAC,GAAG,CAAC,cAAc,OAAO;YACxC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,aAAa,IAAI,KAAK,KAAK,KAAK,KAAK,KAAK;QACpD;QAEA,OAAO;IACT,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,mBAAmB;QAEjC,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}