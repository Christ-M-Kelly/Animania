{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/db/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\n\ndeclare global {\n  var __prisma: PrismaClient | undefined;\n}\n\n// Configuration pour MongoDB avec logs détaillés\nconst prisma =\n  globalThis.__prisma ??\n  new PrismaClient({\n    log: [\"query\", \"info\", \"warn\", \"error\"],\n    datasources: {\n      db: {\n        url: process.env.DATABASE_URL,\n      },\n    },\n  });\n\nif (process.env.NODE_ENV !== \"production\") {\n  globalThis.__prisma = prisma;\n}\n\nexport { prisma };\n"],"names":[],"mappings":";;;;AAAA;;AAMA,iDAAiD;AACjD,MAAM,SACJ,WAAW,QAAQ,IACnB,IAAI,6IAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAQ;QAAQ;KAAQ;IACvC,aAAa;QACX,IAAI;YACF,KAAK,QAAQ,GAAG,CAAC,YAAY;QAC/B;IACF;AACF;AAEF,wCAA2C;IACzC,WAAW,QAAQ,GAAG;AACxB"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/moaye_kelly/WebstormProjects/Animania/app/api/search/route.ts"],"sourcesContent":["import { prisma } from \"@/app/db/prisma\";\nimport { AnimalCategory } from \"@prisma/client\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const searchParams = request.nextUrl.searchParams;\n    const query = searchParams.get(\"q\");\n    const category = searchParams.get(\"category\");\n\n    // Construire les conditions de recherche\n    const where: {\n      published: boolean;\n      AND?: Array<{\n        OR?: Array<{\n          title?: { contains: string; mode: \"insensitive\" };\n          content?: { contains: string; mode: \"insensitive\" };\n        }>;\n        category?: AnimalCategory; // Changement ici : typer correctement\n      }>;\n    } = {\n      published: true,\n    };\n\n    const conditions: Array<{\n      OR?: Array<{\n        title?: { contains: string; mode: \"insensitive\" };\n        content?: { contains: string; mode: \"insensitive\" };\n      }>;\n      category?: AnimalCategory; // Changement ici : typer correctement\n    }> = [];\n\n    // Ajouter la recherche par texte si présent\n    if (query && query.trim()) {\n      conditions.push({\n        OR: [\n          {\n            title: {\n              contains: query.trim(),\n              mode: \"insensitive\",\n            },\n          },\n          {\n            content: {\n              contains: query.trim(),\n              mode: \"insensitive\",\n            },\n          },\n        ],\n      });\n    }\n\n    // Ajouter le filtre par catégorie si présent\n    if (category && category.trim()) {\n      // Valider et convertir la catégorie\n      const validCategories = Object.values(AnimalCategory);\n      const categoryUpperCase = category.trim().toUpperCase() as AnimalCategory;\n\n      if (validCategories.includes(categoryUpperCase)) {\n        conditions.push({\n          category: categoryUpperCase, // Utiliser la catégorie typée\n        });\n      }\n    }\n\n    // Appliquer les conditions\n    if (conditions.length > 0) {\n      where.AND = conditions;\n    }\n\n    // Effectuer la recherche\n    const posts = await prisma.post.findMany({\n      where,\n      include: {\n        author: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n        _count: {\n          select: {\n            comments: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: \"desc\",\n      },\n    });\n\n    return NextResponse.json(\n      {\n        success: true,\n        posts: posts.map((post) => ({\n          ...post,\n          createdAt: post.createdAt.toISOString(),\n          updatedAt: post.updatedAt.toISOString(),\n        })),\n        count: posts.length,\n      },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"❌ Erreur lors de la recherche:\", error);\n    return NextResponse.json(\n      {\n        success: false,\n        message: \"Erreur lors de la recherche\",\n        error: error instanceof Error ? error.message : \"Erreur inconnue\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,QAAQ,aAAa,GAAG,CAAC;QAC/B,MAAM,WAAW,aAAa,GAAG,CAAC;QAElC,yCAAyC;QACzC,MAAM,QASF;YACF,WAAW;QACb;QAEA,MAAM,aAMD,EAAE;QAEP,4CAA4C;QAC5C,IAAI,SAAS,MAAM,IAAI,IAAI;YACzB,WAAW,IAAI,CAAC;gBACd,IAAI;oBACF;wBACE,OAAO;4BACL,UAAU,MAAM,IAAI;4BACpB,MAAM;wBACR;oBACF;oBACA;wBACE,SAAS;4BACP,UAAU,MAAM,IAAI;4BACpB,MAAM;wBACR;oBACF;iBACD;YACH;QACF;QAEA,6CAA6C;QAC7C,IAAI,YAAY,SAAS,IAAI,IAAI;YAC/B,oCAAoC;YACpC,MAAM,kBAAkB,OAAO,MAAM,CAAC,+IAAc;YACpD,MAAM,oBAAoB,SAAS,IAAI,GAAG,WAAW;YAErD,IAAI,gBAAgB,QAAQ,CAAC,oBAAoB;gBAC/C,WAAW,IAAI,CAAC;oBACd,UAAU;gBACZ;YACF;QACF;QAEA,2BAA2B;QAC3B,IAAI,WAAW,MAAM,GAAG,GAAG;YACzB,MAAM,GAAG,GAAG;QACd;QAEA,yBAAyB;QACzB,MAAM,QAAQ,MAAM,+HAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;YACvC;YACA,SAAS;gBACP,QAAQ;oBACN,QAAQ;wBACN,IAAI;wBACJ,MAAM;oBACR;gBACF;gBACA,QAAQ;oBACN,QAAQ;wBACN,UAAU;oBACZ;gBACF;YACF;YACA,SAAS;gBACP,WAAW;YACb;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;oBAC1B,GAAG,IAAI;oBACP,WAAW,KAAK,SAAS,CAAC,WAAW;oBACrC,WAAW,KAAK,SAAS,CAAC,WAAW;gBACvC,CAAC;YACD,OAAO,MAAM,MAAM;QACrB,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}